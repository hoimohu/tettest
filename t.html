<!DOCTYPE html><html lang=ja><meta charset=UTF-8><meta content="width=device-width,initial-scale=1"name=viewport><title>test</title><style>body,canvas,html{width:100%;height:100%;margin:0;padding:0;overflow:hidden;touch-action:none}#chat{position:fixed;bottom:1%;left:.5%;width:100%}#chatinp{width:90%}#chat button{width:8%}#message{transition:.5s;position:fixed;top:10%;left:0;height:80%;opacity:.3;overflow-y:auto;scroll-behavior:smooth}#message::-webkit-scrollbar{opacity:0}#message:hover{opacity:1}#message div{width:fit-content;margin:10px;padding:10px;border-radius:6px;background-color:#fff}.none{display:none}.flex{display:flex}.red{color:red}.blue{color:#00f}.orange{color:orange}</style><div id=chat class=none><input id=chatinp placeholder=„Åì„Åì„Å´ÂÖ•Âäõ„Åó„Å¶Áõ∏Êâã„Å´ÈÄÅ‰ø°...> <button onclick=chatsend()>ÈÄÅ‰ø°</button></div><div id=message></div><script>"use strict";const glowing_version=1.5;console.log("%cGlowing.js üåü version 1.5 is running.","padding:10px;border-left:20px orange solid;border-right:20px orange solid;border-top:6px orange solid;border-bottom:6px orange solid;background-color:#369;color:#fff;");class charObj{constructor(t,e,s,i){this.Run=!0,this.x=t,this.y=e,this.w=null!=s&&s,this.h=null!=i&&i,this.clickFunction=[],this.downFunction=[],this.upFunction=[],this.dragFunction=[],this.items=[],this.readyClick=!1,this.alpha=1,this.angle=0}on(...t){for(let e=0;e<t.length;e++)this.items.push(t[e])}addEvent(t,e){switch(t){case"click":this.clickFunction.push(e);break;case"down":this.downFunction.push(e);break;case"up":this.upFunction.push(e);break;case"drag":this.dragFunction.push(e)}}render(t){if(!0===this.Run)for(let e=0;e<this.items.length;e++)this.items[e].render(t)}resize(t,e){this.w=0!==t||null!=t?t:this.w,this.h=0!==e||null!=e?e:this.h}deleteItem(...t){for(let e=0;e<t.length;e++)for(let s=0;s<this.items.length;s++)this.items[s]===t[e]&&this.items.splice(s,1)}hide(t){null!=t?!0===t?this.Run=!0:!1===t||!0===this.Run?this.Run=!1:!1===this.Run&&(this.Run=!0):!0===this.Run?this.Run=!1:!1===this.Run&&(this.Run=!0)}}class imgObj{constructor(t,e,s,i,h,a,n){if(this.loadstate=!1,this.sx=e,this.sy=s,this.w=null!=i&&i,this.h=null!=h&&h,this.co=null!=a&&a,this.lb=null!=n&&n,"string"==typeof t){this.url=t;const i=new Image;i.src=t,!1===this.w&&i.addEventListener("load",(()=>{this.w=i.naturalWidth-e})),!1===this.h&&i.addEventListener("load",(()=>{this.h=i.naturalHeight-s})),i.addEventListener("load",(()=>{this.loadstate=!0,null!=this.lb&&"function"==typeof this.lb&&this.lb(this)})),this.i=i}else this.url="canvas",this.i=t,this.loadstate=!0,null!=this.lb&&"function"==typeof this.lb&&this.lb(this);this.smooth=!0}sizecalc(t,e,s){function i(t){var e=t.match(/[^ „ÄÄ].*?/g);const s={before:"",after:"",next:"",front:"",calc:!1};for(let t=0;t<e.length;t++){var i=e[t];switch(i){case"*":case"/":case"%":s.front=!0,"*"===s.calc?s.before=""+ +s.before*+s.after:"/"===s.calc?s.before=""+ +s.before/+s.after:"%"===s.calc&&(s.before=""+ +s.before%+s.after),s.after="",s.calc=i;break;case"+":!(s.front=!0)===s.calc?s.next+=s.before+i:"*"===s.calc?s.next+=""+ +s.before*+s.after+i:"/"===s.calc?s.next+=""+ +s.before/+s.after+i:"%"===s.calc&&(s.next+=""+ +s.before%+s.after+i),s.before="",s.after="",s.calc=!1;break;case"-":!0===s.front?s.after+=i:!1===s.front&&(!(s.front=!0)===s.calc?s.next+=s.before+i:"*"===s.calc?s.next+=""+ +s.before*+s.after+i:"/"===s.calc?s.next+=""+ +s.before/+s.after+i:"%"===s.calc&&(s.next+=""+ +s.before%+s.after+i),s.before="",s.after="",s.calc=!1);break;default:(s.front=!1)===s.calc?s.before+=i:s.after+=i,t+1<e.length||(!1===s.calc?s.next+=s.before:"*"===s.calc?s.next+=""+ +s.before*+s.after:"/"===s.calc?s.next+=""+ +s.before/+s.after:"%"===s.calc&&(s.next+=""+ +s.before%+s.after),s.before="",s.after="")}}var h=s.next.split("");const a={before:"",after:"",front:"",calc:!1};for(let t=0;t<h.length;t++){const e=h[t];switch(e){case"+":a.front=!0,"+"===a.calc?a.before=+a.before+ +a.after:"-"===a.calc&&(a.before=+a.before-+a.after),a.calc="+",a.after="";break;case"-":!0===a.front?a.after+=e:!1===a.front&&(a.front=!0,"+"===a.calc?a.before=+a.before+ +a.after:"-"===a.calc&&(a.before=+a.before-+a.after),a.calc="-",a.after="");break;default:(a.front=!1)===a.calc?a.before+=e:a.after+=e,t+1<h.length||("+"===a.calc?a.before=+a.before+ +a.after:"-"===a.calc&&(a.before=+a.before-+a.after),a.after="")}}return+a.before}if(-1===(t+"").indexOf("calc"))return-1!==(t+"").indexOf("%")?e/100*+t.match(/.*(?=%)/)[0]:-1!==(t+"").indexOf("px")?+t.match(/.*(?=px)/)[0]:void 0;return function t(e){var s=e.match(/(?<=\()[^\(\)]*?(?=\))/g),h=e.split(/\([^\(\)]*?\)/g);if(s){const e=[h[0]];for(let t=0;t<s.length;t++)e.push(i(s[t]),h[t+1]);return+t(e.join(""))}return+i(e)}(t.match(/(?<=calc).*\)$/)[0].match(/[^ „ÄÄ].*?/g).join("").replace(/px/g,"").replace(/\d+%(?=\D)(?!\()/g,(function(t){return+t.replace("%","")*e/100})).replace(/\d+@(?=\D)(?!\()/g,(function(t){return+t.replace("@","")*s/100})))}render(t){if(!1===t.width&&!1===t.height&&(t.width=10),-1!==(t.width+"").indexOf("@"))(t.height+"").indexOf("@");else if(-1===(t.height+"").indexOf("@"))if(t.canvasContext.globalAlpha=t.alpha,t.canvasContext.mozImageSmoothingEnabled=this.smooth,t.canvasContext.webkitImageSmoothingEnabled=this.smooth,t.canvasContext.msImageSmoothingEnabled=this.smooth,t.canvasContext.imageSmoothingEnabled=this.smooth,!1===t.height){var e="number"==typeof t.width?t.canvasElement.width/100*t.width:this.sizecalc(t.width,t.canvasElement.width),s=e/this.w*this.h,i="number"==typeof t.x?t.canvasElement.width/100*t.x:this.sizecalc(t.x,t.canvasElement.width,e),h="number"==typeof t.y?t.canvasElement.height/100*t.y:this.sizecalc(t.y,t.canvasElement.height,s);t.canvasContext.translate(i,h),t.canvasContext.rotate(t.angle*Math.PI/180),t.canvasContext.translate(-i,-h),t.canvasContext.drawImage(this.i,this.sx,this.sy,this.w,this.h,i-e/2,h-s/2,e,s)}else if(!1===t.width){const e="number"==typeof t.height?t.canvasElement.height/100*t.height:this.sizecalc(t.height,t.canvasElement.height),s=e/this.h*this.w,i="number"==typeof t.x?t.canvasElement.width/100*t.x:this.sizecalc(t.x,t.canvasElement.width,s),h="number"==typeof t.y?t.canvasElement.height/100*t.y:this.sizecalc(t.y,t.canvasElement.height,e);t.canvasContext.translate(i,h),t.canvasContext.rotate(t.angle*Math.PI/180),t.canvasContext.translate(-i,-h),t.canvasContext.drawImage(this.i,this.sx,this.sy,this.w,this.h,i-s/2,h-e/2,s,e)}else{const e="number"==typeof t.width?t.canvasElement.width/100*t.width:this.sizecalc(t.width,t.canvasElement.width),s="number"==typeof t.height?t.canvasElement.height/100*t.height:this.sizecalc(t.height,t.canvasElement.height),i="number"==typeof t.x?t.canvasElement.width/100*t.x:this.sizecalc(t.x,t.canvasElement.width,e),h="number"==typeof t.y?t.canvasElement.height/100*t.y:this.sizecalc(t.y,t.canvasElement.height,s);t.canvasContext.translate(i,h),t.canvasContext.rotate(t.angle*Math.PI/180),t.canvasContext.translate(-i,-h),t.canvasContext.drawImage(this.i,this.sx,this.sy,this.w,this.h,i-e/2,h-s/2,e,s)}}onPointer(t,e,s,i,h){const a=document.createElement("canvas"),n=a.getContext("2d");var l=Math.sqrt(this.w*this.w+this.h*this.h);return a.width=l,a.height=l,t=!1===s?Math.round(a.width/2+this.h/i*t):Math.round(a.width/2+this.w/s*t),e=!1===i?Math.round(a.height/2+this.w/s*e):Math.round(a.height/2+this.h/i*e),n.globalAlpha=h.alpha,n.mozImageSmoothingEnabled=this.smooth,n.webkitImageSmoothingEnabled=this.smooth,n.msImageSmoothingEnabled=this.smooth,n.imageSmoothingEnabled=this.smooth,n.translate(a.width/2,a.height/2),n.rotate(h.angle*Math.PI/180),n.translate(-a.width/2,-a.height/2),n.drawImage(this.i,this.sx,this.sy,this.w,this.h,(a.width-this.w)/2,(a.height-this.h)/2,this.w,this.h),0<=t&&0<=e&&t<=a.width&&e<=a.height&&(!0===this.co||0<n.getImageData(t,e,1,1).data[3])}loaded(t){return"function"==typeof(t=null!=t&&t)&&(!1===this.loadstate?this.lb=t:!0===this.loadstate&&(this.lb=t,this.lb(this))),this}}class stageObj extends charObj{constructor(t,e,s,i,h,a){super(s,i,h,a),this.addEvent("down",this.pointerDownEvent.bind(this)),this.addEvent("drag",this.pointerDragEvent.bind(this)),this.addEvent("up",this.pointerUpEvent.bind(this)),this.Run=!0,this.resizeRun=!0,this.renderRun=!0,this.dragRun=!1,this.stage=[],this.canvasElement=document.createElement("canvas"),this.canvasContext=this.canvasElement.getContext("2d"),this.canvasElement.innerText="This browser is not supported.\n„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÈùûÂØæÂøú„Åß„Åô„ÄÇ",this.width=t,this.height=e,this.canvasElement.addEventListener("pointerdown",(t=>{var e,s;this.Run&&(s=t.target.getBoundingClientRect(),e=t.clientX-s.left,s=t.clientY-s.top,this.pointerDownEvent(e,s))})),this.canvasElement.addEventListener("pointermove",(t=>{var e,s;this.Run&&(s=t.target.getBoundingClientRect(),e=t.clientX-s.left,s=t.clientY-s.top,this.pointerDragEvent(e,s))})),this.canvasElement.addEventListener("pointerup",(t=>{var e,s;this.Run&&(s=t.target.getBoundingClientRect(),e=t.clientX-s.left,s=t.clientY-s.top,this.pointerUpEvent(e,s))})),this.canvasdraw=new imgObj(this.canvasElement,0,0,this.canvasElement.width,this.canvasElement.height),this.on(this.canvasdraw),this.renderLoop(!0)}renderLoop(t){if(!0===this.Run)if(!0!==t&&!1!==t){switch(this.renderRun){case!0:this.renderRun=!1;break;case!1:this.renderRun=!0}this.renderLoop(this.renderRun)}else if(!0===t){if((this.renderRun=!0)===this.Run){if(!0===this.resizeRun&&(this.canvasElement.width="function"==typeof this.width?this.width():this.width,this.canvasElement.height="function"==typeof this.height?this.height():this.height),!0===this.renderRun)for(let t=0;t<this.stage.length;t++)this.stage[t].render({canvasElement:this.canvasElement,canvasContext:this.canvasContext,x:this.stage[t].x,y:this.stage[t].y,width:this.stage[t].w,height:this.stage[t].h,alpha:this.stage[t].alpha,angle:this.stage[t].angle});this.canvasdraw.i=this.canvasElement,this.canvasdraw.w=this.canvasElement.width,this.canvasdraw.h=this.canvasElement.height,!0!==this.resizeRun&&!0!==this.renderRun||requestAnimationFrame((()=>this.renderLoop(!0)))}}else!1===t&&(this.renderRun=!1)}put(...t){for(let e=0;e<t.length;e++)this.stage.push(t[e])}pointerDownEvent(t,e){if(!0===this.Run)for(let i=this.stage.length-1;0<=i;i--)if(this.pointCheck(i,t)){let h=!1;for(let s=0;s<this.stage[i].items.length;s++)h=!0===h||this.stage[i].items[s].onPointer(t-("number"==typeof this.stage[i].x?this.canvasElement.width/100*this.stage[i].x:this.canvasdraw.sizecalc(this.stage[i].x,this.canvasElement.width,!1!==this.stage[i].w&&("number"==typeof this.stage[i].w?this.canvasElement.width/100*this.stage[i].w:this.canvasdraw.sizecalc(this.stage[i].w,this.canvasElement.width)))),e-("number"==typeof this.stage[i].y?this.canvasElement.height/100*this.stage[i].y:this.canvasdraw.sizecalc(this.stage[i].y,this.canvasElement.height,!1!==this.stage[i].h&&("number"==typeof this.stage[i].h?this.canvasElement.height/100*this.stage[i].h:this.canvasdraw.sizecalc(this.stage[i].h,this.canvasElement.height)))),!1!==this.stage[i].w&&("number"==typeof this.stage[i].w?this.canvasElement.width/100*this.stage[i].w:this.canvasdraw.sizecalc(this.stage[i].w,this.canvasElement.width)),!1!==this.stage[i].h&&("number"==typeof this.stage[i].h?this.canvasElement.height/100*this.stage[i].h:this.canvasdraw.sizecalc(this.stage[i].h,this.canvasElement.height)),{canvasElement:this.canvasElement,canvasContext:this.canvasContext,x:this.stage[i].x,y:this.stage[i].y,width:this.stage[i].w,height:this.stage[i].h,alpha:this.stage[i].alpha,angle:this.stage[i].angle});if(!0===h){var s=this.stage[i].downFunction.length;for(let h=0;h<s;h++)null!=this.stage[i].downFunction&&this.stage[i].downFunction[h](t,e);null!=this.stage[i]&&(this.stage[i].readyClick=!0);break}}}pointerDragEvent(t,e){if(!0===this.Run)for(let i=this.stage.length-1;0<=i;i--)if(this.pointCheck(i,t)&&null!=this.stage[i]&&!0===this.stage[i].readyClick&&(!1===this.dragRun||this.stage[i]===this.dragRun)){var s=this.stage[i].dragFunction.length;for(let h=0;h<s;h++)null!=this.stage[i].dragFunction&&(!1===this.dragRun&&(this.dragRun=this.stage[i]),this.stage[i].dragFunction[h](t,e));break}}pointerUpEvent(t,e){if(!0===this.Run){this.dragRun=!1;for(let h=this.stage.length-1;0<=h;h--){if(this.pointCheck(h,t)){let a=!1;for(let s=0;s<this.stage[h].items.length;s++)a=!0===a||this.stage[h].items[s].onPointer(t-("number"==typeof this.stage[h].x?this.canvasElement.width/100*this.stage[h].x:this.canvasdraw.sizecalc(this.stage[h].x,this.canvasElement.width,!1!==this.stage[h].w&&("number"==typeof this.stage[h].w?this.canvasElement.width/100*this.stage[h].w:this.canvasdraw.sizecalc(this.stage[h].w,this.canvasElement.width)))),e-("number"==typeof this.stage[h].y?this.canvasElement.height/100*this.stage[h].y:this.canvasdraw.sizecalc(this.stage[h].y,this.canvasElement.height,!1!==this.stage[h].h&&("number"==typeof this.stage[h].h?this.canvasElement.height/100*this.stage[h].h:this.canvasdraw.sizecalc(this.stage[h].h,this.canvasElement.height)))),!1!==this.stage[h].w&&("number"==typeof this.stage[h].w?this.canvasElement.width/100*this.stage[h].w:this.canvasdraw.sizecalc(this.stage[h].w,this.canvasElement.width)),!1!==this.stage[h].h&&("number"==typeof this.stage[h].h?this.canvasElement.height/100*this.stage[h].h:this.canvasdraw.sizecalc(this.stage[h].h,this.canvasElement.height)),{canvasElement:this.canvasElement,canvasContext:this.canvasContext,x:this.stage[h].x,y:this.stage[h].y,width:this.stage[h].w,height:this.stage[h].h,alpha:this.stage[h].alpha,angle:this.stage[h].angle});if(!0===a){var s=this.stage[h].upFunction.length;for(let i=0;i<s;i++)null!=this.stage[h].upFunction&&this.stage[h].upFunction[i](t,e);if(null!=this.stage[h]&&!0===this.stage[h].readyClick){var i=this.stage[h].clickFunction.length;for(let s=0;s<i;s++)null!=this.stage[h].clickFunction&&this.stage[h].clickFunction[s](t,e)}break}}null!=this.stage[h]&&(this.stage[h].readyClick=!1)}for(let t=0;t<this.stage.length;t++)null!=this.stage[t]&&(this.stage[t].readyClick=!1)}}pointCheck(t,e){var s=!1!==this.stage[t].w?"number"==typeof this.stage[t].w?this.canvasElement.width/100*this.stage[t].w:this.canvasdraw.sizecalc(this.stage[t].w,this.canvasElement.width):!1===this.stage[t].h&&this.canvasElement.width/100*10;if(!1===this.stage[t].w)return!0===this.stage[t].Run;var i="number"==typeof this.stage[t].x?this.canvasElement.width/100*this.stage[t].x:this.canvasdraw.sizecalc(this.stage[t].x,this.canvasElement.width,s);return i-s/2<e&&e<i+s/2&&!0===this.stage[t].Run}deleteChar(...t){for(let e=0;e<t.length;e++)for(let s=0;s<this.stage.length;s++)this.stage[s]===t[e]&&this.stage.splice(s,1)}remove(){!0===this.Run&&(this.Run=!1)}}class textObj extends imgObj{constructor(t,e,s,i,h){super(!1,0,0,0,0),this.i=document.createElement("canvas"),this.i.width=0,this.i.height=0,this.iCanvasContext=this.i.getContext("2d"),this.font=e,this.size=48,this.fillColor=null!=s?s:"#000",null!=i||null!=h?(this.strokeColor=null!=i?i:"#000",this.strokeWidth=null!=h?h:6):(this.strokeColor=!1,this.strokeWidth=!1),this.setText(t)}setText(t){this.i.width=0,this.i.height=0,this.text=t;var e=this.text.split("\n");this.iCanvasContext.textBaseline="top",this.iCanvasContext.font=this.size+"px "+this.font;let s=0,i=0;for(let t=0;t<e.length;t++){var h=this.iCanvasContext.measureText(e[t]);h.width>s&&(s=h.width),i+=h.actualBoundingBoxDescent+this.size/8}this.i.width=s,this.i.height=i,this.w=this.i.width,this.h=this.i.height,this.iCanvasContext.textBaseline="top",this.iCanvasContext.font=this.size+"px "+this.font;let a=0;for(let t=0;t<e.length;t++){const s=this.iCanvasContext.measureText(e[t]);!1!==this.strokeColor&&!1!==this.strokeWidth&&(this.iCanvasContext.lineWidth=this.strokeWidth,this.iCanvasContext.lineJoin="miter",this.iCanvasContext.strokeStyle=this.strokeColor,this.iCanvasContext.strokeText(e[t],0,a+this.size/14,this.i.width)),this.iCanvasContext.fillStyle=this.fillColor,this.iCanvasContext.fillText(e[t],0,a+this.size/14,this.i.width),a+=s.actualBoundingBoxDescent+this.size/10}}set changeFF(t){this.font=null!=t?t:this.font,this.setText(this.text)}set changeFC(t){this.fillColor=null!=t?t:this.fillColor,this.setText(this.text)}set changeSZ(t){this.size=null!=t?t:this.size,this.setText(this.text)}set changeSC(t){this.strokeColor=null!=t?t:this.strokeColor,this.setText(this.text)}set changeSW(t){this.strokeWidth=null!=t?t:this.strokeWidth,this.setText(this.text)}}class fillObj extends imgObj{constructor(t,e,s,i,h,a,n){super(!1,0,0,1,1),this.i=document.createElement("canvas"),this.iCanvasContext=this.i.getContext("2d"),this.fillColor=null!=t?t:"#000",this.fillWidth=e,this.fillHeight=s,this.marginTop=null!=i?i:0,this.marginRight=null!=h?h:0,this.marginBottom=null!=a?a:0,this.marginLeft=null!=n?n:0,this.smooth=!1,this.setFill()}setFill(t,e,s,i,h,a,n){this.fillColor=null!=t&&!1!==t?t:this.fillColor,this.fillWidth=null!=e&&!1!==e?e:this.fillWidth,this.fillHeight=null!=s&&!1!==s?s:this.fillHeight,this.marginTop=null!=i&&!1!==i?i:this.marginTop,this.marginRight=null!=h&&!1!==h?h:this.marginRight,this.marginBottom=null!=a&&!1!==a?a:this.marginBottom,this.marginLeft=null!=n&&!1!==n?n:this.marginLeft,this.i.width=this.marginLeft+this.fillWidth+this.marginRight,this.i.height=this.marginTop+this.fillHeight+this.marginBottom,this.w=this.i.width,this.h=this.i.height,this.iCanvasContext.fillStyle=this.fillColor,this.iCanvasContext.fillRect(this.marginLeft,this.marginTop,this.fillWidth,this.fillHeight)}}class frameObj extends fillObj{constructor(t,e,s,i,h,a,n,l,r){super(i,t,e,a,n,l,r),this.frameFill=null!=h?h:"rgba(0,0,0,0)",this.iCanvasContext.fillStyle=this.frameFill,this.iCanvasContext.fillRect(this.marginLeft+s,this.marginTop+s,t-2*s,e-2*s)}setFrame(t,e,s,i,h,a,n,l,r){super.setFill(i,t,e,a,n,l,r),this.frameFill=null!=h?h:"rgba(0,0,0,0)",this.iCanvasContext.fillStyle=this.frameFill,this.iCanvasContext.fillRect(this.marginLeft+s,this.marginTop+s,t-2*s,e-2*s)}}</script><script>class field{canvas=document.createElement("canvas");context=this.canvas.getContext("2d");picture=document.createElement("canvas");pctx=this.picture.getContext("2d");netstroke=document.createElement("canvas");nsctx=this.netstroke.getContext("2d");data=[];constructor(t,i,s,h){this.width=t,this.height=i,this.netstroke.width=30,this.netstroke.height=30,this.picture.width=30*this.width,this.picture.height=30*this.height,22<this.height?(this.canvas.width=30*this.width,this.canvas.height=660):(this.canvas.width=30*this.width,this.canvas.height=30*this.height),this.nsctx.lineWidth="2",this.nsctx.strokeStyle="gray",this.nsctx.beginPath(),this.nsctx.moveTo(0,0),this.nsctx.lineTo(0,30),this.nsctx.lineTo(30,30),this.nsctx.lineTo(30,0),this.nsctx.lineTo(0,0),this.nsctx.stroke();for(let s=0;s<i;s++){this.data.push([]);for(let i=0;i<t;i++)this.data.at(-1).push("")}null!=s&&this.setelement(s),null!=h&&(this.gameover=h)}render(){for(let t=0;t<this.data.length;t++)for(let i=0;i<this.data.length;i++){const s=this.data[t][i];this.pctx.globalAlpha=1,""===s?(this.pctx.fillStyle="black",this.pctx.fillRect(30*i,30*t,30,30)):"i"===s?(this.pctx.fillStyle="cyan",this.pctx.fillRect(30*i,30*t,30,30)):"o"===s?(this.pctx.fillStyle="yellow",this.pctx.fillRect(30*i,30*t,30,30)):"t"===s?(this.pctx.fillStyle="purple",this.pctx.fillRect(30*i,30*t,30,30)):"s"===s?(this.pctx.fillStyle="greenyellow",this.pctx.fillRect(30*i,30*t,30,30)):"z"===s?(this.pctx.fillStyle="red",this.pctx.fillRect(30*i,30*t,30,30)):"j"===s?(this.pctx.fillStyle="blue",this.pctx.fillRect(30*i,30*t,30,30)):"l"===s?(this.pctx.fillStyle="orange",this.pctx.fillRect(30*i,30*t,30,30)):"d"===s&&(this.pctx.fillStyle="azure",this.pctx.fillRect(30*i,30*t,30,30)),this.pctx.globalAlpha=.4,this.pctx.drawImage(this.netstroke,30*i,30*t)}return this}netline(){this.pctx.globalAlpha=1,this.pctx.fillStyle="black",this.pctx.fillRect(0,0,this.picture.width,this.picture.height);for(let t=0;t<this.data.length;t++)for(let i=0;i<this.data.length;i++)this.pctx.globalAlpha=.4,this.pctx.drawImage(this.netstroke,30*i,30*t);return this}drawfield(){this.context.drawImage(this.picture,0,this.picture.height-this.canvas.height,this.canvas.width,this.canvas.height,0,0,this.canvas.width,this.canvas.height)}isblock(t,i){return t<0||i<0||this.width<=t||this.height<=i||""!==this.data[i][t]}setelement(t){this.element=t,t.appendChild(this.canvas)}}class mino{landing=!1;fallTimer=10;fallCounter=0;fallCounterCounter=0;angle=0;tspin=!1;miniTspin=!1;inter=setInterval((()=>{!1===this.landing?this.fallTimer<=0?(this.minodown(),this.fallTimer=10):this.fallTimer--:clearInterval(this.inter)}),125);constructor(t,i,s){this.type=t,this.canvas=i.canvas,this.context=i.context,this.width=i.width,this.height=i.height,this.field=i,null!=s&&(this.landFunction=s),"i"===t?(this.x=5,this.y=2,this.data=[[-3,-1],[-1,-1],[1,-1],[3,-1]]):"t"===t?(this.x=4,this.y=2,this.data=[[-1,0],[0,0],[1,0],[0,-1]]):"l"===t?(this.x=4,this.y=2,this.data=[[1,-1],[-1,0],[0,0],[1,0]]):"j"===t?(this.x=4,this.y=2,this.data=[[-1,-1],[-1,0],[0,0],[1,0]]):"s"===t?(this.x=4,this.y=2,this.data=[[-1,0],[0,0],[0,-1],[1,-1]]):"z"===t?(this.x=4,this.y=2,this.data=[[-1,-1],[0,-1],[0,0],[1,0]]):"o"===t&&(this.x=5,this.y=1,this.data=[[-1,-1],[-1,1],[1,1],[1,-1]]),this.y=this.field.height-22+this.y;let h=!0;for(let i=0;i<this.data.length;i++){const s=this.data[i];"i"===t||"o"===t?this.field.isblock((15*s[0]+30*this.x-15)/30,(15*s[1]+30*this.y-15)/30)&&(h=!1):this.field.isblock(s[0]+this.x,s[1]+this.y)&&(h=!1)}if(!1===h){this.y--,h=!0;for(let i=0;i<this.data.length;i++){const s=this.data[i];"i"===t||"o"===t?this.field.isblock((15*s[0]+30*this.x-15)/30,(15*s[1]+30*this.y-15)/30)&&(h=!1):this.field.isblock(s[0]+this.x,s[1]+this.y)&&(h=!1)}!1===h&&this.field.gameover()}}rotate(t,i=0){if("i"===this.type||"o"===this.type?1===i?0===this.angle?this.x-=1===t?2:1:1===this.angle?1===t?this.x-=1:this.x+=2:2===this.angle?this.x+=1===t?2:1:3===this.angle&&(1===t?this.x+=1:this.x-=2):2===i?0===this.angle?this.x+=3:1===this.angle?1===t?this.x+=3:this.x-=3:2===this.angle?this.x-=3:3===this.angle&&(1===t?this.x-=3:this.x+=3):3===i?0===this.angle?1===t?(this.x-=3,this.y+=1):(this.x-=3,this.y-=2):1===this.angle?1===t?(this.x-=3,this.y-=2):(this.x+=3,this.y-=1):2===this.angle?1===t?(this.x+=3,this.y-=1):(this.x+=3,this.y+=2):3===this.angle&&(1===t?(this.x+=3,this.y+=2):(this.x-=3,this.y+=1)):4===i?0===this.angle?1===t?(this.x+=3,this.y-=3):(this.x+=3,this.y+=3):1===this.angle?1===t?(this.x+=3,this.y+=3):(this.x-=3,this.y+=3):2===this.angle?1===t?(this.x-=3,this.y+=3):(this.x-=3,this.y-=3):3===this.angle&&(1===t?(this.x-=3,this.y-=3):(this.x+=3,this.y+=3)):5===i&&(0===this.angle?1===t?(this.x-=1,this.y+=2):(this.x-=2,this.y-=1):1===this.angle?1===t?(this.x-=2,this.y-=1):(this.x+=1,this.y-=2):2===this.angle?1===t?(this.x+=1,this.y-=2):(this.x+=2,this.y+=1):3===this.angle&&(1===t?(this.x+=2,this.y+=1):(this.x-=1,this.y+=2))):1===i?0===this.angle?1===t?this.x-=1:this.x+=1:1===this.angle?this.x+=1:2===this.angle?1===t?this.x+=1:this.x-=1:3===this.angle&&(this.x-=1):2===i?0===this.angle?this.y-=1:1===this.angle?this.y+=1:2===this.angle?this.y-=1:3===this.angle&&(this.y+=1):3===i?0===this.angle?1===t?(this.x+=1,this.y+=3):(this.x-=1,this.y+=3):1===this.angle?(this.x-=1,this.y-=3):2===this.angle?1===t?(this.x-=1,this.y+=3):(this.x+=1,this.y+=3):3===this.angle&&(this.x+=1,this.y-=3):4===i?0===this.angle?1===t?this.x-=1:this.x+=1:1===this.angle?this.x+=1:2===this.angle?1===t?this.x+=1:this.x-=1:3===this.angle&&(this.x-=1):5===i&&(0===this.angle?1===t?(this.x+=1,this.y-=2):(this.x-=1,this.y-=2):1===this.angle?(this.x-=1,this.y+=2):2===this.angle?1===t?(this.x-=1,this.y-=2):(this.x+=1,this.y-=2):3===this.angle&&(this.x+=1,this.y+=2)),1===t)for(let t=0;t<this.data.length;t++){const i=this.data[t],s=i[0],h=i[1];i[0]=-h,i[1]=s}else if(-1===t)for(let t=0;t<this.data.length;t++){const i=this.data[t],s=i[0],h=i[1];i[0]=h,i[1]=-s}let s=!0;for(let t=0;t<this.data.length;t++){const i=this.data[t];"i"===this.type||"o"===this.type?this.field.isblock((15*i[0]+30*this.x-15)/30,(15*i[1]+30*this.y-15)/30)&&(s=!1):this.field.isblock(i[0]+this.x,i[1]+this.y)&&(s=!1)}if(!1===s){if(-1===t)for(let t=0;t<this.data.length;t++){const i=this.data[t],s=i[0],h=i[1];i[0]=-h,i[1]=s}else if(1===t)for(let t=0;t<this.data.length;t++){const i=this.data[t],s=i[0],h=i[1];i[0]=h,i[1]=-s}5!==i&&this.rotate(t,++i)}else{if(this.angle+=t,this.fallCounter=1,4===this.angle?this.angle=0:-1===this.angle&&(this.angle=3),"t"===this.type){let t=0;this.field.isblock(this.x-1,this.y-1)&&t++,this.field.isblock(this.x+1,this.y-1)&&t++,this.field.isblock(this.x+1,this.y+1)&&t++,this.field.isblock(this.x-1,this.y+1)&&t++,2<t&&(this.tspin=!0),this.tspin&&(0===this.angle?!1!==this.field.isblock(this.x+1,this.y-1)&&!1!==this.field.isblock(this.x-1,this.y-1)||(this.miniTspin=!0):1===this.angle?!1!==this.field.isblock(this.x+1,this.y+1)&&!1!==this.field.isblock(this.x+1,this.y-1)||(this.miniTspin=!0):2===this.angle?!1!==this.field.isblock(this.x+1,this.y+1)&&!1!==this.field.isblock(this.x-1,this.y+1)||(this.miniTspin=!0):3===this.angle&&(!1!==this.field.isblock(this.x-1,this.y+1)&&!1!==this.field.isblock(this.x-1,this.y-1)||(this.miniTspin=!0)))}this.render()}}control(t){if(!1===this.landing){if(" "===t)for(clearInterval(this.inter);!1===this.landing;)this.minodown();else if("ArrowUp"===t)this.rotate(1);else if("z"===t)this.rotate(-1);else if("ArrowRight"===t){let t=!0;for(let i=0;i<this.data.length;i++){const s=this.data[i];"i"===this.type||"o"===this.type?this.field.isblock((15*s[0]+30*this.x-15)/30+1,(15*s[1]+30*this.y-15)/30)&&(t=!1):this.field.isblock(s[0]+this.x+1,s[1]+this.y)&&(t=!1)}!0===t&&(this.fallCounter=1,this.x++,this.tspin=!1,this.miniTspin=!1)}else if("ArrowDown"===t){this.y++;let t=!0;for(let i=0;i<this.data.length;i++){const s=this.data[i];"i"===this.type||"o"===this.type?this.field.isblock((15*s[0]+30*this.x-15)/30,(15*s[1]+30*this.y-15)/30)&&(t=!1):this.field.isblock(s[0]+this.x,s[1]+this.y)&&(t=!1)}!1===t?(this.y--,this.fallTimer--):(this.tspin=!1,this.miniTspin=!1)}else if("ArrowLeft"===t){let t=!0;for(let i=0;i<this.data.length;i++){const s=this.data[i];"i"===this.type||"o"===this.type?this.field.isblock((15*s[0]+30*this.x-15)/30-1,(15*s[1]+30*this.y-15)/30)&&(t=!1):this.field.isblock(s[0]+this.x-1,s[1]+this.y)&&(t=!1)}!0===t&&(this.fallCounter=1,this.x--,this.tspin=!1,this.miniTspin=!1)}this.render()}}minodown(){if(!1===this.landing){this.y++;let t=!0;for(let i=0;i<this.data.length;i++){const s=this.data[i];"i"===this.type||"o"===this.type?this.field.isblock((15*s[0]+30*this.x-15)/30,(15*s[1]+30*this.y-15)/30)&&(t=!1):this.field.isblock(s[0]+this.x,s[1]+this.y)&&(t=!1)}if(!1===t)if(this.y--,1!==this.fallCounter||5<this.fallCounterCounter){this.landing=!0;for(let t=0;t<this.data.length;t++){const i=this.data[t];"i"===this.type||"o"===this.type?0<=(15*i[1]+30*this.y-15)/30&&(this.field.data[(15*i[1]+30*this.y-15)/30][(15*i[0]+30*this.x-15)/30]=this.type):0<=i[1]+this.y&&(this.field.data[i[1]+this.y][i[0]+this.x]=this.type)}this.field.render(),null!=this.landFunction&&this.landFunction()}else this.fallCounterCounter++;else this.tspin=!1,this.miniTspin=!1;this.fallCounter=0,this.render()}else this.inter=null}render(){if(!1===this.landing){let t=this.y,i=!0;for(;i;){let s=!0;for(let i=0;i<this.data.length;i++){const h=this.data[i];"i"===this.type||"o"===this.type?this.field.isblock((15*h[0]+30*this.x-15)/30,(15*h[1]+30*t-15)/30)&&(s=!1):this.field.isblock(h[0]+this.x,h[1]+t)&&(s=!1)}!0===s?t++:(t--,i=!1)}this.field.drawfield();for(let t=0;t<this.data.length;t++){const i=this.data[t];this.context.globalAlpha=1,"i"===this.type?(this.context.fillStyle="cyan",this.context.fillRect(15*i[0]+30*this.x-15,15*i[1]+30*(this.y+22-this.field.height)-15,30,30)):"o"===this.type?(this.context.fillStyle="yellow",this.context.fillRect(15*i[0]+30*this.x-15,15*i[1]+30*(this.y+22-this.field.height)-15,30,30)):"t"===this.type?(this.context.fillStyle="purple",this.context.fillRect(30*(i[0]+this.x),30*(i[1]+this.y+22-this.field.height),30,30)):"s"===this.type?(this.context.fillStyle="greenyellow",this.context.fillRect(30*(i[0]+this.x),30*(i[1]+this.y+22-this.field.height),30,30)):"z"===this.type?(this.context.fillStyle="red",this.context.fillRect(30*(i[0]+this.x),30*(i[1]+this.y+22-this.field.height),30,30)):"j"===this.type?(this.context.fillStyle="blue",this.context.fillRect(30*(i[0]+this.x),30*(i[1]+this.y+22-this.field.height),30,30)):"l"===this.type&&(this.context.fillStyle="orange",this.context.fillRect(30*(i[0]+this.x),30*(i[1]+this.y+22-this.field.height),30,30)),this.context.globalAlpha=.4,"i"===this.type||"o"===this.type?this.context.drawImage(this.field.netstroke,15*i[0]+30*this.x-15,15*i[1]+30*(this.y+22-this.field.height)-15):this.context.drawImage(this.field.netstroke,30*(i[0]+this.x),30*(i[1]+this.y+22-this.field.height))}this.context.globalAlpha=.6;for(let i=0;i<this.data.length;i++){const s=this.data[i];"i"===this.type?(this.context.fillStyle="cyan",this.context.fillRect(15*s[0]+30*this.x-15,15*s[1]+30*(t+22-this.field.height)-15,30,30)):"o"===this.type?(this.context.fillStyle="yellow",this.context.fillRect(15*s[0]+30*this.x-15,15*s[1]+30*(t+22-this.field.height)-15,30,30)):"t"===this.type?(this.context.fillStyle="purple",this.context.fillRect(30*(s[0]+this.x),30*(s[1]+t+22-this.field.height),30,30)):"s"===this.type?(this.context.fillStyle="greenyellow",this.context.fillRect(30*(s[0]+this.x),30*(s[1]+t+22-this.field.height),30,30)):"z"===this.type?(this.context.fillStyle="red",this.context.fillRect(30*(s[0]+this.x),30*(s[1]+t+22-this.field.height),30,30)):"j"===this.type?(this.context.fillStyle="blue",this.context.fillRect(30*(s[0]+this.x),30*(s[1]+t+22-this.field.height),30,30)):"l"===this.type&&(this.context.fillStyle="orange",this.context.fillRect(30*(s[0]+this.x),30*(s[1]+t+22-this.field.height),30,30))}}}}</script><script>const stage=new stageObj((()=>innerWidth),(()=>innerHeight)),iconsrc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAApCAYAAABz26rUAAAAAXNSR0IArs4c6QAAAidJREFUWEftWMltw0AMlOtKFXbyzDcNuAA/XIAbyDdPx6nCdSVggDEohqdWRwTIHwPaXe4Mh8Ndadet/LdbOf5uI7C0gpMqcHg6fN/ut0n3mDT4agjMAdQq1U0ByoylQKsymfWjKICN6D/TlaSxM0AnLSEO/PPrGnJ43r90nESLgs0K0OYSNAG0fpjLSVQIyLlNBDh4Dvr8elbxnz5Ov88liUUIaOAt4JwNJwEVFiVAIDLAJQmuAo2RJ7wmYJ3o6RKSWYICmdKR9SRVwLjXACy10gQkCE6AFACoqP55HA2w1gA0tRAnTcBTAKBBwupAl7fLY+j4fuyZGQNaAiiu1r1ozYNAdJhkCXCQ3oFABDzQWtkRCXmGlBSQQRGQK1AhUDE/VDAJRNcBy2C8C9EmYxKQJekqgBYWdQKtLMZUgIPWPOMqIN0uwVoGo3lVEuQBzfyWgjB9SAAlQZnI1ihvoZky4gZGkqLSG0SAZza6YlrSYx0HDbD0LALO14ce0LpKVgXayDsHNKCzEIhU0EBXslqZW1YgyiqNSwCVrNL67PyyB+TtsZKp7NwsAe4feSvtXSWkB0Ai01m42cYiAODex7F/R8DLttYJVQLSuBUFsmWhtVd6Vv0U+YcABcGdvHq6RmWkHWBVwFKF3m3Ues8dooAmdytYt4QwaH1p8IypZXZIOUSnfYoATcp+YUPAKTKbJZN+ockGnHveRmDujLtdaGkwQ/ZffQn9AMT2MUjamBt7AAAAAElFTkSuQmCC";let fieldi,fieldc,pfieldi,pfieldc;const holdc=new charObj(10,5,!1,8),damagec=new charObj(10,15,!1,8),scorec=new charObj(50,90,!1,4),nextc=[new charObj(90,5,!1,10),new charObj(90,15,!1,10),new charObj(90,25,!1,10),new charObj(90,35,!1,10),new charObj(90,45,!1,10)],scorei=new textObj("score: 0","sans-serif","#fff","#000",4);scorec.on(scorei);const bcgi=new fillObj("skyblue",100,100),bcgc=new charObj(50,50,100,100);bcgc.on(bcgi);const iconi=new imgObj(iconsrc,0,0),iconc=new charObj(50,25,50);iconc.on(iconi);const fulli=new textObj("ÂÖ®ÁîªÈù¢Ë°®Á§∫","sans-serif","#fff","#000",6),fullc=new charObj(50,"calc(100%-100@)",!1,3);function msgDisplay(e,n,o){const t=null!=o?o:0;let i=100;const a=new textObj(e,"sans-serif","#fff",n,4),l=new charObj(50,50+15*t,!1,15);l.on(a),stage.put(l);const r=setInterval((()=>{0<i?(i--,l.alpha=i/100):(i=0,clearInterval(r))}),10)}fullc.addEvent("click",full),fulli.co=!0,fullc.on(fulli);let gamemode,sock,game=!1,fullscreen=!1,runstopbool=!0;const mino7=["i","t","o","s","z","l","j"],nextMino=[];let main,dMain,pMain,nowMino,battleFunction,endBattleFunction,attackBattleFunction,ren=-1,btb=!1,score=0,holdMino="none",permHold=!0,lasthole=null,gameset=!1,HNalpha=!1,RQA=!1,mydamage=[];const chatElement=document.getElementById("chat"),chatinp=document.getElementById("chatinp"),messageElement=document.getElementById("message");let sendChatFunction;function send(e){null!=sock&&sock.send(JSON.stringify(e))}function chatsend(){null==sendChatFunction||chatinp.value.match(/^[\s„ÄÄ·Öü·Ö†·†é‚Äã‚Äå‚Å£‚Äç‚Å†‚Å°‚Å¢‚Å£‚Å§„Ö§Ôæ†]*$/)||(sendChatFunction(chatinp.value),chatinp.value="")}function techsend(e){null!=sendChatFunction&&sendChatFunction(e,!0)}chatinp.addEventListener("keydown",(e=>{"Enter"===e.key&&chatsend()}));const previewMino={i:new field(4,4),t:new field(3,3),s:new field(3,3),z:new field(3,3),j:new field(3,3),l:new field(3,3),o:new field(4,4),none:new field(4,4)};previewMino.i.data[1][0]="i",previewMino.i.data[1][1]="i",previewMino.i.data[1][2]="i",previewMino.i.data[1][3]="i",previewMino.i.netline().render().drawfield(),previewMino.t.data[1][0]="t",previewMino.t.data[1][1]="t",previewMino.t.data[1][2]="t",previewMino.t.data[0][1]="t",previewMino.t.netline().render().drawfield(),previewMino.s.data[0][1]="s",previewMino.s.data[0][2]="s",previewMino.s.data[1][0]="s",previewMino.s.data[1][1]="s",previewMino.s.netline().render().drawfield(),previewMino.z.data[0][0]="z",previewMino.z.data[0][1]="z",previewMino.z.data[1][1]="z",previewMino.z.data[1][2]="z",previewMino.z.netline().render().drawfield(),previewMino.j.data[0][0]="j",previewMino.j.data[1][0]="j",previewMino.j.data[1][1]="j",previewMino.j.data[1][2]="j",previewMino.j.netline().render().drawfield(),previewMino.l.data[0][2]="l",previewMino.l.data[1][0]="l",previewMino.l.data[1][1]="l",previewMino.l.data[1][2]="l",previewMino.l.netline().render().drawfield(),previewMino.o.data[0][1]="o",previewMino.o.data[1][1]="o",previewMino.o.data[0][2]="o",previewMino.o.data[1][2]="o",previewMino.o.netline().render().drawfield(),previewMino.none.netline().render().drawfield();let rightLoopPerm=!1,rightLoopNow=!1,rightLoopCount=0,rightLoop60=setInterval((()=>{RQA?clearInterval(rightLoop60):game&&(!0===rightLoopPerm&&!1===leftLoopNow?(rightLoopNow=!0,rightLoopCount++):(rightLoopNow=!1,rightLoopCount=0),(1===rightLoopCount||10<rightLoopCount)&&rightLoopCount%2==1&&null!=nowMino&&nowMino.control("ArrowRight"))}),1e3/60);function rightLoop(){RQA&&(game&&(!0===rightLoopPerm&&!1===leftLoopNow?(rightLoopNow=!0,rightLoopCount++):(rightLoopNow=!1,rightLoopCount=0),(1===rightLoopCount||10<rightLoopCount)&&rightLoopCount%2==1&&null!=nowMino&&nowMino.control("ArrowRight")),requestAnimationFrame(rightLoop))}let leftLoopPerm=!1,leftLoopNow=!1,leftLoopCount=0,leftLoop60=setInterval((()=>{RQA?clearInterval(leftLoop60):game&&(!0===leftLoopPerm&&!1===rightLoopNow?(leftLoopNow=!0,leftLoopCount++):(leftLoopNow=!1,leftLoopCount=0),(1===leftLoopCount||10<leftLoopCount)&&leftLoopCount%2==1&&null!=nowMino&&nowMino.control("ArrowLeft"))}),1e3/60);function leftLoop(){RQA&&(game&&(!0===leftLoopPerm&&!1===rightLoopNow?(leftLoopNow=!0,leftLoopCount++):(leftLoopNow=!1,leftLoopCount=0),(1===leftLoopCount||10<leftLoopCount)&&leftLoopCount%2==1&&null!=nowMino&&nowMino.control("ArrowLeft")),requestAnimationFrame(leftLoop))}let downLoopPerm=!1,downLoopCount=0,downLoop60=setInterval((()=>{RQA?clearInterval(downLoop60):game&&(!0===downLoopPerm?downLoopCount++:downLoopCount=0,downLoopCount%2==1&&null!=nowMino&&nowMino.control("ArrowDown"))}),1e3/60);function downLoop(){RQA&&(game&&(!0===downLoopPerm?downLoopCount++:downLoopCount=0,downLoopCount%2==1&&null!=nowMino&&nowMino.control("ArrowDown")),requestAnimationFrame(downLoop))}function RQAor60FPS(){RQA?(RQA=!1,rightLoop60=setInterval((()=>{RQA?clearInterval(rightLoop60):game&&(!0===rightLoopPerm&&!1===leftLoopNow?(rightLoopNow=!0,rightLoopCount++):(rightLoopNow=!1,rightLoopCount=0),(1===rightLoopCount||10<rightLoopCount)&&rightLoopCount%2==1&&null!=nowMino&&nowMino.control("ArrowRight"))}),1e3/60),leftLoop60=setInterval((()=>{RQA?clearInterval(leftLoop60):game&&(!0===leftLoopPerm&&!1===rightLoopNow?(leftLoopNow=!0,leftLoopCount++):(leftLoopNow=!1,leftLoopCount=0),(1===leftLoopCount||10<leftLoopCount)&&leftLoopCount%2==1&&null!=nowMino&&nowMino.control("ArrowLeft"))}),1e3/60),downLoop60=setInterval((()=>{RQA?clearInterval(downLoop60):game&&(!0===downLoopPerm?downLoopCount++:downLoopCount=0,downLoopCount%2==1&&null!=nowMino&&nowMino.control("ArrowDown"))}),1e3/60),RQAor60btni.setText("60")):(RQA=!0,rightLoop(),leftLoop(),downLoop(),RQAor60btni.setText("Ëá™Âãï"))}const RQAor60btnc=new charObj(96,96,2,2),RQAor60btni=new textObj("60","sans-serif","orange","#000",4);function minobag(e=!1){if(game&&runstopbool){let o=0,t=0,i=!0;for(let e=0;e<main.data.length;e++){if(-1===main.data[e].indexOf("")){main.data.splice(e,1);const n=[];for(let e=0;e<main.width;e++)n.push("");main.data.unshift(n),t++}""!==main.data[e].join("")&&(i=!1)}function n(){if(game){if(runstopbool=!0,nextMino.length<=5)for(;nextMino.length<=5;){const e=JSON.parse(JSON.stringify(mino7));for(;0!==e.length;)nextMino.push(e.splice(Math.floor(Math.random()*e.length),1)[0])}nowMino=new mino(nextMino.shift(),main,minobag);for(let e=0;e<5;e++){const n=previewMino[nextMino[e]].canvas.cloneNode();n.getContext("2d").drawImage(previewMino[nextMino[e]].canvas,0,0),nextc[e].items=[new imgObj(n,0,0,n.width,n.height)]}if(null!=holdMino){const e=previewMino[holdMino].canvas.cloneNode();e.getContext("2d").drawImage(previewMino[holdMino].canvas,0,0),holdc.items=[new imgObj(e,0,0,e.width,e.height)]}score+=100*o,scorei.setText("score: "+score),nowMino.render(),"battle"===gamemode&&(attackBattleFunction(o),battleFunction()),permHold=!e}else nowMino.landing=!0}0!==t&&main.render().drawfield(),null!=nowMino&&nowMino.tspin&&(0===t?nowMino.miniTspin?(msgDisplay("Mini T-Spin","#00f"),techsend("Mini T-Spin")):(msgDisplay("T-Spin","#00f"),techsend("T-Spin")):1===t?nowMino.miniTspin?(msgDisplay("Mini T-Spin Single","#00f"),techsend("Mini T-Spin Single")):(msgDisplay("T-Spin Single","#00f"),techsend("T-Spin Single"),o+=2):2===t?nowMino.miniTspin?(msgDisplay("Mini T-Spin Double","#00f"),techsend("Mini T-Spin Double")):(msgDisplay("T-Spin Double","#00f"),techsend("T-Spin Double"),o+=3):3===t&&(msgDisplay("T-Spin Triple","#00f"),techsend("T-Spin Triple"),o+=4),btb&&!0===nowMino.tspin&&0<t?(msgDisplay("Back-to-Back","#00f",1),techsend("Back-to-Back"),o+=1):!0===nowMino.tspin&&0<t&&(btb=!0)),4===t?(msgDisplay("Tetris","#00f"),techsend("Tetris"),o+=4,btb?(msgDisplay("Back-to-Back","#00f",1),techsend("Back-to-Back"),o+=1):btb=!0):0<t&&!1===nowMino.tspin&&(btb=!1,o+=t-1),i&&0<t?(ren++,msgDisplay("Perfect Clear","greenyellow",-2),techsend("Perfect Clear"),o+=10):0<t?(ren++,0<ren&&(msgDisplay(ren+"REN","#00f",-1),techsend(ren+"REN")),10<ren?o+=5:7<ren?o+=4:5<ren?o+=3:3<ren?o+=2:1<ren&&(o+=1)):!1===e&&(ren=-1),0<t?(runstopbool=!1,setTimeout(n,300)):n()}else"normal"===gamemode?(nowMino.landing=!0,startMenu(),msgDisplay("GAME OVER","red")):"battle"===gamemode&&(endBattleFunction(),nowMino.landing=!0)}function start(){if(rightLoopPerm=!1,rightLoopCount=0,leftLoopPerm=!1,leftLoopCount=0,downLoopPerm=!1,downLoopCount=0,gamemode="normal",null!=nowMino)for(main.canvas.remove(),nowMino.landing=!0;0!==nextMino.length;)nextMino.shift();game=!0,runstopbool=!0,btb=!1,score=0,ren=-1,holdMino="none",permHold=!0;let e=document.createElement("div");main=new field(10,50,e,(()=>{game=!1,gameset=!0,e.remove(),e=null})),main.netline().drawfield();for(let e=0;e<nextc.length;e++)nextc[e].x=90;fieldi=new imgObj(main.canvas,0,0,main.canvas.width,main.canvas.height),fieldc=new charObj(50,50,!1,80),fieldc.on(fieldi),iconi.smooth=!0,stage.stage=[bcgc,iconc,fullc,RQAor60btnc,fieldc,holdc,scorec,nextc[0],nextc[1],nextc[2],nextc[3],nextc[4]],minobag()}function battle(){if("battle"!==gamemode){if(messageElement.innerHTML="",gamemode="battle",rightLoopPerm=!1,rightLoopCount=0,leftLoopPerm=!1,leftLoopCount=0,downLoopPerm=!1,downLoopCount=0,chatinp.value="",null!=nowMino)for(main.canvas.remove(),nowMino.landing=!0;0!==nextMino.length;)nextMino.shift();game=!0,runstopbool=!0,btb=!1,score=0,ren=-1,holdMino="none",permHold=!0,mydamage=[];let e=document.createElement("div");main=new field(10,50,e,(()=>{game=!1,gameset=!0,e.remove(),e=null}));for(let e=0;e<nextc.length;e++)nextc[e].x="calc((100%-100@/3*10*2)/2+100@/3*10)";if(null!=holdMino){const e=previewMino[holdMino].canvas.cloneNode();e.getContext("2d").drawImage(previewMino[holdMino].canvas,0,0),holdc.items=[new imgObj(e,0,0,e.width,e.height)]}main.netline().drawfield(),pMain=new field(10,50,e),pMain.netline().drawfield(),dMain=new field(1,1,e),dMain.netline().drawfield(),damagec.items=[new imgObj(dMain.canvas,0,0,dMain.canvas.width,dMain.canvas.height)],fieldi=new imgObj(main.canvas,0,0,main.canvas.width,main.canvas.height),fieldc=new charObj("calc((100%-200@)/4+50@)",50,!1,80),fieldc.on(fieldi),pfieldi=new imgObj(pMain.canvas,0,0,pMain.canvas.width,pMain.canvas.height),pfieldc=new charObj("calc(100%-((100%-200@)/4+50@))",50,!1,80),pfieldc.on(pfieldi),iconi.smooth=!0;for(let e=0;e<5;e++){const n=previewMino.none.canvas.cloneNode();n.getContext("2d").drawImage(previewMino.none.canvas,0,0),nextc[e].items=[new imgObj(n,0,0,n.width,n.height)]}stage.stage=[bcgc,iconc,fullc,RQAor60btnc,pfieldc,fieldc,damagec,holdc,nextc[0],nextc[1],nextc[2],nextc[3],nextc[4]],null==sock&&(msgDisplay("„Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö„Åó„Åæ„Åô","blue"),sock=new WebSocket("ws://127.0.0.1:8080"),sock.addEventListener("open",(()=>{chatElement.className="flex",battleFunction=()=>{send({type:"battle",battle:"field",data:main.data})},endBattleFunction=()=>{gameset&&send({type:"battle",battle:"lose",score:score})},attackBattleFunction=e=>{if(e<=mydamage.length){dMain.data[0][0]="",dMain.render().drawfield();for(let e=0;e<mydamage.length;e++)main.data.shift(),main.data.push(mydamage[e]);mydamage=[],main.render().drawfield()}else send({type:"battle",battle:"attack",data:e-mydamage})},sendChatFunction=(e,n)=>{send(!0===n?{type:"tech",data:e}:{type:"chat",data:e})}})),sock.addEventListener("message",(e=>{const n=JSON.parse(e.data);if("key"===n.type)send({type:"keyconnect",data:n.data});else if("count"===n.type){if(3===n.count){for(;nextMino.length<=5;){const e=JSON.parse(JSON.stringify(mino7));for(;0!==e.length;)nextMino.push(e.splice(Math.floor(Math.random()*e.length),1)[0])}for(let e=0;e<5;e++){const n=previewMino[nextMino[e]].canvas.cloneNode();n.getContext("2d").drawImage(previewMino[nextMino[e]].canvas,0,0),nextc[e].items=[new imgObj(n,0,0,n.width,n.height)]}}msgDisplay(""+n.count,"blue")}else if("start"===n.type)msgDisplay("START!","greenyellow"),main.netline().drawfield(),minobag();else if("attack"===n.type){const e=[];if(null!=lasthole&&.25<Math.random()){const n=lasthole;for(let o=0;o<main.width;o++)o===n?e.push(""):e.push("d")}else{const n=Math.floor(Math.random()*main.width);lasthole=n;for(let o=0;o<main.width;o++)o===n?e.push(""):e.push("d")}for(let o=0;o<n.data;o++)mydamage.push(JSON.parse(JSON.stringify(e)));0===mydamage.length?dMain.data[0][0]="i":1===mydamage.length?dMain.data[0][0]="j":2===mydamage.length?dMain.data[0][0]="l":3===mydamage.length?dMain.data[0][0]="o":4===mydamage.length?dMain.data[0][0]="s":5===mydamage.length?dMain.data[0][0]="t":5<mydamage.length&&(dMain.data[0][0]="z"),dMain.render().drawfield()}else if("field"===n.type)pMain.data=n.data,pMain.render().drawfield();else if("lose"===n.type){gamemode="fin",game=!1,nowMino.landing=!0;const e=document.createElement("div");e.classList.add("blue"),e.innerText="„ÅÇ„Å™„Åü„ÅÆ„Åæ„Åë„Åß„Åô„ÄÇ„ÄÇ„ÄÇ„ÄÇ\n„Éª„Éª„Éª„Çπ„Ç≥„Ç¢: "+score+"\n\nÁõ∏Êâã„ÅÆ„Çπ„Ç≥„Ç¢: "+n.score,messageElement.appendChild(e),e.scrollIntoView(!1),msgDisplay("You lose...","blue"),setTimeout((()=>{msgDisplay("You lose...","blue");const e=new textObj("„Å§„Å•„Åë„Å¶Ë™∞„Åã„Å®ÂØæÊà¶„Åô„Çã","sans-serif","#fff","#000",4),n=new frameObj(600,50,2,"#00f","#fff"),o=new charObj(50,60,!1,5);o.addEvent("click",(()=>send({type:"continue"}))),o.on(n,e),stage.put(o)}),1e3)}else if("win"===n.type){gamemode="fin",game=!1,nowMino.landing=!0;const e=document.createElement("div");e.classList.add("orange"),e.innerText="„Åã„Å°ÔºÅÔºÅÔºÅÔºÅ\n„Éª„Éª„Éª„Çπ„Ç≥„Ç¢: "+score+"\n\nÁõ∏Êâã„ÅÆ„Çπ„Ç≥„Ç¢: "+n.score,messageElement.appendChild(e),e.scrollIntoView(!1),send({type:"battle",battle:"win",score:score}),msgDisplay("YOU WIN!!","greenyellow"),setTimeout((()=>{msgDisplay("YOU WIN!!","greenyellow");const e=new textObj("„Å§„Å•„Åë„Å¶Ë™∞„Åã„Å®ÂØæÊà¶„Åô„Çã","sans-serif","#fff","#000",4),n=new frameObj(600,50,2,"#00f","#fff"),o=new charObj(50,60,!1,5);o.addEvent("click",(()=>send({type:"continue"}))),o.on(n,e),stage.put(o)}),1e3)}else if("chat"===n.type){"„Çè„Åñ„Éª„ÅäÁõ∏Êâã"===n.owner&&msgDisplay(n.data,"red",2);const e=document.createElement("div");e.innerText=n.owner+": "+n.data,messageElement.appendChild(e),e.scrollIntoView(!1)}else if("disconnect"===n.type){msgDisplay("Áõ∏Êâã„ÅÆÊé•Á∂ö„ÅåÂàáÊñ≠„Åï„Çå„Åæ„Åó„Åü","red");const e=document.createElement("div");e.classList.add("red"),e.innerText="Áõ∏Êâã„ÅÆÊé•Á∂ö„ÅåÂàáÊñ≠„Åï„Çå„Åæ„Åó„Åü",messageElement.appendChild(e),e.scrollIntoView(!1),send({type:"partnernull"})}else"continue"===n.type&&battle()})),sock.addEventListener("close",(()=>{msgDisplay("„Çµ„Éº„Éê„Éº„Å®„ÅÆÊé•Á∂ö„ÅåÂàáÊñ≠„Åï„Çå„Åæ„Åó„Åü","red");const e=document.createElement("div");e.classList.add("red"),e.innerText="„Çµ„Éº„Éê„Éº„Å®„ÅÆÊé•Á∂ö„ÅåÂàáÊñ≠„Åï„Çå„Åæ„Åó„Åü",messageElement.appendChild(e),e.scrollIntoView(!1)})),sock.addEventListener("error",(()=>{msgDisplay("„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü","red");const e=document.createElement("div");e.classList.add("red"),e.innerText="„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü",messageElement.appendChild(e),e.scrollIntoView(!1)})))}}function full(){!1===fullscreen?(document.body.requestFullscreen(),fullscreen=!0):(document.exitFullscreen(),fullscreen=!1)}function startMenu(){if("startmenu"!==gamemode){if(rightLoopPerm=!1,rightLoopCount=0,leftLoopPerm=!1,leftLoopCount=0,downLoopPerm=!1,downLoopCount=0,null!=nowMino)for(main.canvas.remove(),nowMino.landing=!0;0!==nextMino.length;)nextMino.shift();game=!1,nowMino=null,main=null}messageElement.innerHTML="",chatElement.className="none",stage.stage=[],iconi.smooth=!1,gamemode="startmenu";const e=new textObj("„Å≤„Å®„Çä„Åß„Éó„É¨„Ç§","sans-serif","#fff","#000",4),n=new frameObj(600,80,2,"#00f","#fff"),o=new charObj(50,60,!1,5);o.addEvent("click",start),o.on(n,e);const t=new textObj("„Åµ„Åü„Çä„Åß„Éó„É¨„Ç§","sans-serif","#fff","#000",4),i=new frameObj(600,80,2,"#00f","#fff"),a=new charObj(50,85,!1,5);a.addEvent("click",battle),a.on(i,t),stage.put(bcgc,iconc,o,a,fullc,RQAor60btnc)}RQAor60btni.co=!0,RQAor60btnc.on(RQAor60btni),RQAor60btnc.addEvent("click",RQAor60FPS),document.addEventListener("keydown",(e=>{if(game&&null!=nowMino){if(!1===e.repeat)if(" "===e.key&&(score+=5),"ArrowRight"===e.key)rightLoopPerm=!0;else if("ArrowLeft"===e.key)leftLoopPerm=!0;else if("ArrowDown"===e.key)downLoopPerm=!0;else if("c"===e.key)permHold&&runstopbool&&("none"===holdMino?(nowMino.landing=!0,holdMino=nowMino.type,minobag(!0)):(nowMino.landing=!0,nextMino.unshift(holdMino),holdMino=nowMino.type,minobag(!0)));else if("a"===e.key)if(!1===HNalpha){for(let e=-2;e<5;e++)-2===e?damagec.alpha=.6:-1===e?holdc.alpha=.6:nextc[e].alpha=.6;HNalpha=!0}else{for(let e=-2;e<5;e++)-2===e?damagec.alpha=1:-1===e?holdc.alpha=1:nextc[e].alpha=1;HNalpha=!1}else"r"===e.key&&"normal"===gamemode?start():"r"===e.key&&"fin"===gamemode?null!=sock&&send({type:"continue"}):"Escape"===e.key&&"normal"===gamemode?startMenu():runstopbool&&nowMino.control(e.key)}else!1===game&&null!=nowMino&&"Escape"===e.key&&"fin"===gamemode&&startMenu()})),document.addEventListener("keyup",(e=>{game&&("ArrowRight"===e.key?rightLoopPerm=!1:"ArrowLeft"===e.key?leftLoopPerm=!1:"ArrowDown"===e.key&&(downLoopPerm=!1))})),window.onload=()=>{document.body.appendChild(stage.canvasElement),startMenu()};</script>